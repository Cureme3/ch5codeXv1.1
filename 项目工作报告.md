# 项目工作报告

## 项目概述
**项目路径**: `D:\python projects\ch5codeXv1.1`
**项目主题**: 航天器故障诊断与轨迹重规划

---

## 第二章 - 轨道动力学仿真 (`ch2codev1.1/`)

### 核心程序
| 程序 | 功能 |
|------|------|
| `ch2_kz1a_eci.py` | KZ-1A运载火箭ECI坐标系轨道仿真主程序 |

### 生成图表命令
```powershell
cd "D:\python projects\ch5codeXv1.1\ch2codev1.1"
python ch2_kz1a_eci.py
```

### 输出文件 (`exports/`)
- `fig_h_t.png` - 高度-时间曲线
- `fig_m_t.png` - 质量-时间曲线
- `fig_n_t.png` - 过载-时间曲线
- `fig_q_t.png` - 动压-时间曲线
- `fig_v_t.png` - 速度-时间曲线
- `fig_vr_t.png` - 径向速度-时间曲线
- `fig_fpa_t.png` - 飞行航迹角-时间曲线

---

## 第三章 - 故障诊断 (`ch3codev1.1/`)

### 核心模块
| 模块 | 功能 |
|------|------|
| `diagnosis/classifier.py` | 故障分类器 |
| `diagnosis/eso.py` | 扩张状态观测器(ESO) |
| `diagnosis/features.py` | 特征提取 |
| `sim/eci_full.py` | ECI坐标系完整仿真 |

### 核心脚本
| 脚本 | 功能 |
|------|------|
| `train_eval_classifier.py` | 训练和评估分类器 |
| `make_fig_all.py` | 生成所有图表 |
| `make_tables_ch3.py` | 生成所有表格 |
| `make_dataset_cache.py` | 生成数据集缓存 |
| `verify_fault_injection.py` | 验证故障注入 |

### 生成图表命令
```powershell
cd "D:\python projects\ch5codeXv1.1\ch3codev1.1"

# 1. 生成数据集缓存（首次运行需要）
python make_dataset_cache.py

# 2. 训练分类器
python train_eval_classifier.py

# 3. 生成所有图表
python make_fig_all.py

# 4. 生成所有表格
python make_tables_ch3.py
```

### 输出文件
**图表** (`exports/`):
- `fig3_2_*.png` - 故障特征图
- `fig3_3_*.png` - ESO观测结果
- `fig3_4_*.png` - 分类性能图
- `fig3_7_*.png`, `fig3_8_*.png` - 诊断结果图

**表格** (`exports/`):
- `table3_1_fault_params.csv` - 故障参数表
- `table3_4_*.csv` - 分类性能统计
- `table3_5_*.csv/md` - 诊断结果统计

---

## 第四章 - 轨迹重规划 (`ch4codexv1.1/`)

### 核心模块
| 模块路径 | 功能 |
|----------|------|
| `src/opt/scvx.py` | 序列凸优化(SCvx)算法 |
| `src/opt/constraints.py` | 约束条件定义 |
| `src/opt/warmstart.py` | 热启动策略 |
| `src/sim/run_nominal.py` | 标称轨迹仿真 |
| `src/sim/run_fault.py` | 故障轨迹仿真 |
| `src/learn/model.py` | 学习模型 |
| `src/learn/warmstart.py` | 热启动学习 |

### 核心脚本（按功能分类）

**主入口**:
| 脚本 | 功能 |
|------|------|
| `scripts/make_figs_ch4.py` | 第四章图表生成主入口 |

**评估脚本**:
| 脚本 | 功能 |
|------|------|
| `scripts/eval_ch4_scvx_convergence.py` | SCvx收敛性评估 |
| `scripts/eval_ch4_warmstart_performance.py` | 热启动性能评估 |
| `scripts/eval_ch4_mission_domains.py` | 任务域评估 |
| `scripts/eval_ch4_trajectories_replan.py` | 轨迹重规划评估 |

**图表生成脚本**:
| 脚本 | 输出 |
|------|------|
| `make_figs_ch4_scvx_convergence.py` | fig4_07 SCvx收敛曲线 |
| `make_figs_ch4_adaptive_weights.py` | fig4_15 自适应权重 |
| `make_figs_ch4_warmstart_stats.py` | fig4_16~18 热启动统计 |
| `make_figs_ch4_warmstart_case.py` | 热启动案例图 |
| `make_figs_ch4_learning_curves.py` | fig4_10~12 学习曲线 |
| `make_figs_ch4_learning_altitude.py` | fig4_13~14 高度学习 |
| `make_figs_ch4_fault_trajectories.py` | fig4_25~30 故障轨迹 |
| `make_figs_ch4_mission_domains.py` | 任务域3D图+2D汇总 |
| `make_figs_ch4_mission_domains_stats.py` | 任务域统计 |
| `make_figs_ch4_mission_domain_trajectories.py` | 任务域轨迹 |
| `make_figs_ch5_section5.py` | 5.5节综合验证图 |

**表格生成**:
| 脚本 | 功能 |
|------|------|
| `scripts/make_tables_ch4.py` | 生成第四章表格 |
| `scripts/make_tables_ch4_core.py` | 核心表格生成 |

### 生成图表命令
```powershell
cd "D:\python projects\ch5codeXv1.1\ch4codexv1.1"

# 方式1: 一键生成所有图表
python scripts/make_figs_ch4.py

# 方式2: 分别生成各类图表
python scripts/make_figs_ch4_scvx_convergence.py      # SCvx收敛
python scripts/make_figs_ch4_adaptive_weights.py      # 自适应权重
python scripts/make_figs_ch4_warmstart_stats.py       # 热启动统计
python scripts/make_figs_ch4_learning_curves.py       # 学习曲线
python scripts/make_figs_ch4_fault_trajectories.py    # 故障轨迹
python scripts/make_figs_ch4_mission_domains.py       # 任务域

# 生成表格
python scripts/make_tables_ch4.py
```

### 输出文件
**图表** (`outputs/figures/`):
| 子目录 | 内容 |
|--------|------|
| `ch4_scvx_convergence/` | fig4_07 SCvx收敛图 (4个) |
| `ch4_adaptive_weights/` | fig4_15 自适应权重图 (2个) |
| `ch4_warmstart/` | fig4_16~18 热启动性能图 (3个) |
| `ch4_learning/` | fig4_10~14 学习曲线图 (5个) |
| `ch4_trajectories_replan/` | fig4_25~30 重规划轨迹图 (6个) |
| `ch4_mission_domains/` | 任务域3D+2D图 (7个) |
| `ch4_mission_domains_3d/` | 任务域3D可视化旧版 (7个) |
| `ch5_section5/` | 5.5节综合验证图 (3个) |

**表格** (`outputs/tables/`):
- `scvx_stats*.csv` - SCvx统计表
- `adaptive_weights*.csv` - 自适应权重表
- `warmstart*.csv` - 热启动性能表
- `mission_domain*.csv` - 任务域配置表

---

## 第五章 - 综合验证 (5.5节图表在 `ch4codexv1.1/`)

### 核心脚本
| 脚本 | 功能 |
|------|------|
| `scripts/make_figs_ch5_section5.py` | 生成5.5节所有图表 |

### 生成图表命令
```powershell
cd "D:\python projects\ch5codeXv1.1\ch4codexv1.1"
python scripts/make_figs_ch5_section5.py
```

### 输出文件 (`outputs/figures/ch5_section5/`)
| 文件 | 图号 | 内容 |
|------|------|------|
| `fig5_16_severe_downrange_summary.png` | 图5-16 | 严重故障下终端落点纵程箱线图 (η=0.8) |
| `fig5_17_all_domains_downrange_altitude.png` | 图5-17 | 纵程-高度散点图 (按任务域着色) |
| `fig5_18_domain_configuration_comparison.png` | 图5-18 | 任务域配置对比柱状图 |

---

## 快速开始 - 一键生成全部图表

```powershell
# 第二章
cd "D:\python projects\ch5codeXv1.1\ch2codev1.1" && python ch2_kz1a_eci.py

# 第三章
cd "D:\python projects\ch5codeXv1.1\ch3codev1.1" && python make_fig_all.py && python make_tables_ch3.py

# 第四章
cd "D:\python projects\ch5codeXv1.1\ch4codexv1.1" && python scripts/make_figs_ch4.py && python scripts/make_tables_ch4.py

# 第五章(5.5节)
cd "D:\python projects\ch5codeXv1.1\ch4codexv1.1" && python scripts/make_figs_ch5_section5.py
```

---

## 项目目录结构概览

```
ch5codeXv1.1/
├── 项目工作报告.md         # 本报告
│
├── src/plots/plotting.py   # 绘图配置模块
│
├── ch2codev1.1/           # 第二章：轨道动力学
│   ├── ch2_kz1a_eci.py    # 主程序
│   └── exports/           # 输出图表 (7个PNG)
│       ├── fig_h_t.png    # 高度-时间
│       ├── fig_v_t.png    # 速度-时间
│       ├── fig_vr_t.png   # 径向速度-时间
│       ├── fig_q_t.png    # 动压-时间
│       ├── fig_n_t.png    # 过载-时间
│       ├── fig_m_t.png    # 质量-时间
│       └── fig_fpa_t.png  # 飞行航迹角-时间
│
├── ch3codev1.1/           # 第三章：故障诊断
│   ├── diagnosis/         # 诊断模块
│   │   ├── classifier.py  # 故障分类器
│   │   ├── eso.py         # 扩张状态观测器
│   │   └── features.py    # 特征提取
│   ├── sim/               # 仿真模块
│   │   └── eci_full.py    # ECI坐标系完整仿真
│   ├── scripts/           # 脚本目录 (5个)
│   │   ├── make_fig_all.py
│   │   ├── make_tables_ch3.py
│   │   ├── make_dataset_cache.py
│   │   ├── train_eval_classifier.py
│   │   └── verify_fault_injection.py
│   └── exports/           # 输出
│       ├── ch3_figures/   # 图表
│       └── ch3_tables/    # 表格
│
├── ch4codexv1.1/          # 第四章+第五章
│   ├── opt/               # 优化模块(旧版)
│   ├── src/
│   │   ├── opt/           # 优化模块
│   │   │   ├── scvx.py    # SCvx算法
│   │   │   ├── constraints.py
│   │   │   ├── discretization.py
│   │   │   ├── linearization.py
│   │   │   └── socp_problem.py
│   │   ├── sim/           # 仿真模块
│   │   │   ├── run_nominal.py
│   │   │   ├── run_fault.py
│   │   │   ├── mission_domains.py
│   │   │   └── scenarios.py
│   │   ├── learn/         # 学习模块
│   │   │   ├── model.py
│   │   │   ├── warmstart.py
│   │   │   └── weights.py
│   │   └── plots/         # 绘图工具
│   │       └── plotting.py
│   ├── scripts/           # 脚本目录 (22个)
│   └── outputs/           # 输出目录
│       ├── figures/       # 图表
│       │   ├── ch4_scvx_convergence/
│       │   ├── ch4_adaptive_weights/
│       │   ├── ch4_warmstart/
│       │   ├── ch4_learning/
│       │   ├── ch4_trajectories_replan/
│       │   ├── ch4_mission_domains/
│       │   ├── ch4_mission_domains_3d/
│       │   └── ch5_section5/
│       ├── tables/        # 表格 (15个CSV)
│       └── data/          # 数据
│
└── exports/               # 导出目录
```

---

## 项目统计

**Python文件总数**: 69个
**更新日期**: 2025年12月2日

**文件分布**:
- ch2codev1.1: 1个核心程序
- ch3codev1.1: 10个文件 (6个脚本 + 4个模块)
- ch4codexv1.1: 58个文件 (22个脚本 + 36个模块)

## 清理记录

**清理日期**: 2025年

**删除的文件**（17个辅助/调试脚本）:

| 目录 | 删除文件 | 原因 |
|------|----------|------|
| ch4 scripts/ | `run_scvx_demo.py.bak` | 备份文件 |
| ch4 scripts/ | `scan_guidance_params.py` | 参数调试脚本 |
| ch4 scripts/ | `scan_ascent_params.py` | 参数调试脚本 |
| ch4 scripts/ | `extract_ch4_figures_tables.py` | Word文档提取工具 |
| ch4 scripts/ | `make_index_ch4_figs_tables.py` | 索引生成工具 |
| ch4 scripts/ | `check_ch4_fig_table_coverage.py` | 覆盖检查工具 |
| ch4 scripts/ | `make_final_status_report.py` | 状态报告工具 |
| ch4 scripts/ | `spec_ch4_fig_table_manifest.py` | 清单定义文件 |
| ch4 scripts/ | `generate_ch4_mock_data.py` | 模拟数据生成 |
| ch4 scripts/ | `demo_diag_bridge.py` | 演示脚本 |
| ch4 scripts/ | `test_control_injection.py` | 测试脚本 |
| ch4 scripts/ | `test_adaptive_weights.py` | 测试脚本 |
| ch4 scripts/ | `test_require_orbit.py` | 测试脚本 |
| ch4 scripts/ | `test_eta_scaling.py` | 测试脚本 |
| ch4 src/sim/ | `mock_scvx.py` | 模拟SCvx模块 |
| ch4 src/sim/ | `test_run_fault_interface.py` | 接口测试 |
| ch3 scripts/ | `check_fault_params.py` | 参数验证脚本 |
| ch3 scripts/ | `profile_complexity.py` | 运算量分析脚本 |

**清理前后对比**:
- 清理前：82 个 Python 文件
- 清理后：65 个 Python 文件
- 减少：17 个文件（20.7%）

**验证结果**：所有核心模块和图表生成脚本正常工作

---

## 绘图规范说明

**绘图规范**（适用于所有图表生成脚本）:
- 字体族: 宋体 + Times New Roman (Serif)
- 数学字体: STIX
- 分辨率: 300 DPI
- 线宽: 2.0
- 字号: 坐标轴12pt, 标题14pt
- 图形尺寸: (6, 4.5) 英寸

**配置文件**: `src/plots/plotting.py` (ch4) / `scripts/make_fig_all.py` (ch3)

---

## 2025-12-02 更新记录

### 图表更新
1. **第三章图表**: 更新为Serif字体规范 (300 DPI)
2. **第四章图表**: 更新为Serif字体规范 (300 DPI)
3. **3D任务域图**: 新增故障开环轨迹(灰色虚线)和轨道高度参考线
   - 500km: 标称轨道 (绿色)
   - 300km: 降级轨道 (橙色)
   - 0km: 地面着陆 (红色)

### 输出汇总
- `ch4_mission_domains/`: 5个3D轨迹图 + 1个2D汇总图
- `ch4_fault_trajectories/`: 15个故障轨迹图 + 约束图
- `ch5_section5/`: 3个综合验证图
