# 表3-5 静态锁定说明

## 锁定状态

**表3-5（算法复杂度与资源占用）已静态锁定**，不会随训练参数变化而更新。

---

## 当前锁定的数值

| 模块 | 运算量（乘加次数/周期） | 周期（ms） | 运行频率（Hz） | 是否可下放/合并 |
|------|-------------------------|------------|----------------|------------------|
| STFT特征 | 80 | 50 | 20 | 与PWVD取舍/可裁剪 |
| PWVD特征 | 64 | 50 | 20 | 与STFT取舍/可降采样 |
| RBF分类推断 | 192 | 50 | 20 | 可合并到特征线程 |
| ESO残差生成 | 2,000 | 10 | 100 | 硬实时时钟，高频不可下放 |

**文件位置**：`exports/ch3_tables/table3_5_complexity_resources.csv`

---

## 锁定依据

### 1. 数值来源
- **STFT/PWVD**：基于频带能量统计的运算量（不含FFT本身，假设硬件加速）
- **RBF推断**：基于 N_c=36, d=4 的输出层矩阵乘法
- **ESO残差**：基于 4状态×2观测 的扩张状态观测器，包含冗余开销

### 2. 验证结果
详见 `table3_5_complexity_validation.md`：
- STFT/PWVD：量级合理（仅统计特征提取部分）
- RBF推断：量级合理（百位数，实际可能200-800）
- ESO残差：数值偏保守，但适合资源评估

### 3. 适用范围
当前锁定数值适用于：
- RBFNN 中心数：20-50个（量级不变）
- 输入特征维度：3-6维（量级不变）
- ESO 通道数：1-3个（可按比例缩放）
- 采样频率：100Hz（±20%）

---

## 自动保护机制

`scripts/make_tables_ch3.py` 中的 `make_table3_5_complexity` 函数已实现静态锁定：

```python
def make_table3_5_complexity(outdir):
    existing_path = os.path.join(outdir, "table3_5_complexity_resources.csv")
    if os.path.exists(existing_path):
        print(f"[Info] Found existing table: {existing_path}, keeping it.")
        return  # 直接返回，不覆盖
    # ... 仅在文件不存在时创建默认模板
```

**保护效果**：
- 运行 `make_tables_ch3.py` 时，会检测到现有文件并保留
- 不会因为重新训练或参数调整而覆盖表格
- 需要手动删除 CSV 才能重新生成

---

## 何时需要更新

**仅在以下情况手动更新表3-5**：

1. **量级变化**：
   - RBFNN 中心数从 36 增加到 100+ （运算量约3倍）
   - 输入特征维度从 4 增加到 10+ （运算量约2.5倍）
   - ESO 从 2 通道扩展到 6 通道（运算量约3倍）

2. **架构变更**：
   - 从 RBFNN 切换到深度神经网络
   - 引入 GPU 加速（需单独说明硬件资源）
   - 增加在线学习模块

3. **实测数据**：
   - 在目标嵌入式平台（如 PowerPC、ARM Cortex-R）上实测
   - 使用 profiler 获得精确的 CPU 周期数
   - 需要在论文中更新为"实测数据"

**否则，保持当前数值不变。**

---

## 论文写作建议

### 推荐表述

在论文正文中引用表3-5时，使用以下表述：

> "表3-5给出了基于当前算法实现的**运算量估算**，用于论证所提方法在典型飞控计算资源下的可行性。其中，时频分析（STFT/PWVD）的主体计算假设由硬件加速器完成，此处统计的乘加次数仅指特征提取阶段。RBFNN推断与ESO残差生成运行在主CPU上，按保守估计给出资源占用。在200MHz处理器上，单周期诊断任务的总运算量约为 **2.3K次乘加**（50ms周期）+ **2K次乘加**（10ms周期），峰值负载约 **30%**，满足实时性要求。"

### 避免的表述

❌ "精确到指令级的性能测试"
❌ "在某飞控计算机上实测的结果"
❌ "硬实时保证的运算量上界"

### 可以加强的表述

✓ "量级评估"
✓ "保守估算"
✓ "基于原型实现的分析"
✓ "为嵌入式部署提供参考"

---

## 总结

1. **表3-5 已静态锁定**，不会随后续实验调整而变化
2. **脚本已配置自动保护**，运行 `make_tables_ch3.py` 会保留现有文件
3. **数值量级合理**，适用于论文中的可行性论证
4. **论文表述已优化**，强调"估算"而非"实测"
5. **后续更新条件明确**，仅在架构或量级显著变化时手动修改

**结论：表3-5 可作为稳定的设计指标使用，无需随训练参数动态更新。**
